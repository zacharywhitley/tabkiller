---
name: Event Tracking System
status: open
created: 2025-09-05T01:58:28Z
updated: 2025-09-05T02:07:24Z
github: https://github.com/zacharywhitley/tabkiller/issues/9
depends_on: [001]
parallel: false
conflicts_with: []
---

# Task 002: Event Tracking System

## Description

Implement the core event tracking system that monitors user browsing behavior across tabs and windows. This system captures navigation events, tab operations, and window management activities to build a comprehensive browsing history graph.

## Acceptance Criteria

- [ ] Tab creation, switching, and closing events captured
- [ ] Window creation, focus changes, and closing events tracked  
- [ ] Page navigation events (URL changes, redirects) recorded
- [ ] Browsing session detection and segmentation implemented
- [ ] Event data normalization and validation
- [ ] Privacy-safe data extraction (no sensitive form data)
- [ ] Event batching and local storage mechanism
- [ ] Performance monitoring (minimal impact on browsing)
- [ ] Cross-browser event compatibility verified
- [ ] Unit tests covering all tracking scenarios

## Technical Details

### Event Categories
1. **Navigation Events**
   - Page loads, redirects, history changes
   - URL parsing and normalization
   - Title and metadata extraction

2. **Tab Events**
   - Tab created, activated, moved, closed
   - Tab relationships (parent-child, duplicated from)
   - Tab state changes (pinned, muted, etc.)

3. **Window Events**
   - Window created, focused, minimized, closed
   - Window type detection (normal, popup, app)
   - Multi-window session correlation

4. **Session Events**
   - Session start/end detection
   - Idle time tracking
   - User-initiated session tagging

### Architecture
```
src/
├── tracking/
│   ├── EventTracker.ts (Main coordinator)
│   ├── TabTracker.ts (Tab-specific events)
│   ├── WindowTracker.ts (Window-specific events)
│   ├── NavigationTracker.ts (Page navigation)
│   └── SessionTracker.ts (Session management)
├── models/
│   ├── BrowsingEvent.ts
│   ├── TabEvent.ts
│   ├── WindowEvent.ts
│   └── Session.ts
├── storage/
│   ├── LocalEventStore.ts (Temporary storage)
│   └── EventBatcher.ts (Batch processing)
└── utils/
    ├── UrlNormalizer.ts
    ├── PrivacyFilter.ts
    └── SessionDetector.ts
```

### Event Data Schema
```typescript
interface BrowsingEvent {
  id: string;
  timestamp: number;
  type: EventType;
  tabId?: number;
  windowId?: number;
  url?: string;
  title?: string;
  sessionId: string;
  metadata: Record<string, any>;
}
```

### Privacy & Performance
- No password fields, form data, or sensitive content
- URL parameter filtering for privacy
- Efficient event batching to reduce storage calls
- Memory usage monitoring and cleanup
- Configurable tracking granularity

## Dependencies

- **001 - Extension Foundation**: Requires background service worker and content script infrastructure

## Effort Estimate

**3 days**

- Day 1: Core event tracking infrastructure and tab/window monitors
- Day 2: Navigation tracking, session detection, and data models
- Day 3: Privacy filtering, performance optimization, and comprehensive testing

## Definition of Done

1. All browser events are captured reliably across Chrome and Firefox
2. Event data is properly normalized and validated
3. Privacy filters prevent sensitive data collection  
4. Performance impact is minimal (< 2ms per event)
5. Local storage batching works efficiently
6. Session detection accurately identifies browsing sessions
7. Unit tests cover all event types and edge cases
8. Cross-browser compatibility validated
9. Memory usage remains stable during extended use
10. All acceptance criteria validated and checked off
